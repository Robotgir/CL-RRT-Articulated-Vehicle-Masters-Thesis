# CL-RRT Implementation for single articulated vehicle in Python
## Table of contents
* Closed-Loop system Design 
* Heuristic map generating Algorithm
* CL-RRT PLANNER
## Closed-Loop system Design 
Pure Pursuit controller and virtual steering wheel concept are used to forward simulate a Single Articulated Vehicle(SAV). 
To see performance of the above combination Run Python_Implementation/purepursuitcontroller_waypoints/purepursuit_waypoints.py

## Heuristic map generating Algorithm
CL-RRT planner makes use of strategies that aid in obtaining feasible and optimal solution paths. The following strategies aid in obtaining probabilistically increasing optimal paths.
The strategies that are implemented in this project are
* Exploring strategy 
Used to explore the region of interest within the provided obstacle map 
* Towards goal Biasing strategy
Used to drive the expanding planning tree in the direction of the goal
For detailed explaination refere thesis doc
To achieve both these strategies a Heuristic map has to be calculated. This Heuristic map is a collection of distance metric from a (0,0) position to each point 
point in the predefined grid region. For this thesis a grid region -50<=x<+50, -50<=y<=+50 is obtained. Initially calculated with resolution of 5m and lateron 
interpolated with the resolution of 0.5m.

To generate a Heuristic map go to lib>hmapsf_Initializ.m and follow the instructions
<img src="/lib/images/hmapforward.jpg" width=600>
<img src="/lib/images/hmapreverse.jpg" width=600>
## CL-RRT PLANNER
In this project the CL-RRT algorithm implemented incrementally builds a planning tree by forward simulating the "Closed-Loop system Design" over a predefined 
region of map with defined static obstacles. While building the planning tree the previously mentioned,  "Heuristic map generating Algorithm" generated "Heuristic 
map forward direction and reverse directions (lib>heuristicmap.mat>Hmap_frwd and Hmap_rev)" are used to increase the optimal nature of the tree extensions.

To obtain results from the motion planner, three consecutive files have to be run one after(one has to wait until the individual file is run completely to 
start the next ).
1. clrrtsf_Initializ.m, this file initializes the planner with required heuristic maps, variables like initial pose and final pose etc.
2. clrrtsf.slx, this is a Simulink Stateflow model that has the CL-RRT motion planner.
3. clrrtsolutionplot.m, this file makes use of the data generated by the planning tree, and finds the obtained number of solution, single best optimal path(shortest path)
and conseqvently plots the expanded planning tree, obtained solution path and its respective piece wise linear reference path.
<img src="/lib/images/clrrtsolplotforgithub.jpg">
  
<!--### heuristic.m
https://bulldogjob.com/news/449-how-to-write-a-good-readme-for-your-github-project

simulation of Single Articulated Vehicle(SAV) using Pure Pursuit controller 

Heuristic map, to find nearest neighbour from the collection of tree nodes to the sample, is calculated offline. with resolution of 0.5m in grid size 0to50(m) on X axis, -50to50(m) on Y axis in right half plane,i.e,in 1st and 4th quadrants. Obtained results are mirrored to left half plane.
function, simmodelcaller() calls mod_purepcontroller.slx which includes vehicle and path tracking controller simulink model.
By calling  simmodelcaller() we forward simulate to each goal point in the grid.

Heuristic map can be plotted in two ways.
1.by calling heuristicmapplot.plot 
2. by using the cost values from cell array c(:,3) along with respective co-ordinates a "2-D look up table" can be obtained. In the respective lookup table dialogbox there is an option to 3D plot. 
example: hmaprev double array saved in heuristicmap.mat has co-ordinates in its 1st and 2nd columns and corresponding cost in 3rd column.
for hmapfrwd as well.
 
### treeexpansion.m
main script is treeexpansion.m. It has CL-RRT algorithm implemented as a script file with locally defined functions at the bottom of script file.
treeexpansion.m file is calling a simulink model named mod_purepcontroller.slx in every iteration and succesfull simulations add nodes and expand the tree.

### current status:
the above files produce tree extensions based on CL-RRT algorithm by oskar and store nodes in cell array "tn", But is very slow as calling simulink model from matlab script file lets the simulink model recompile at every iteration.
### planned future steps:
Integrate the treeexpansion.m into the simulink model and speed up the process.
heuristicmap costs will be accessed by a 2-D look up table within the simulink model.-->
